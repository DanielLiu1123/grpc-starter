---
sidebar_position: 10
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# gRPC HTTP transcoding

This extension is Java implementation of [gRPC HTTP transcoding](https://cloud.google.com/endpoints/docs/grpc/transcoding),
like [grpc-gateway](https://github.com/grpc-ecosystem/grpc-gateway) in Go.

## Why Not Use Sidecar

Why not just use a sidecar like [Envoy gRPC-JSON transcoder](https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/grpc_json_transcoder_filter)
to do the transcoding?

- Sidecar is like a black box and is inconvenient for debugging and testing
- Scalability is not enough, and transcoding customization is challenging.

## Dependencies

Choose the appropriate dependencies based on your technology stack.

<Tabs>
    <TabItem value="webmvc" label="Web MVC">
        <Tabs>
            <TabItem value="gradle" label="Gradle">
                ```groovy
                implementation("io.github.danielliu1123:grpc-starter-transcoding-webmvc")
                ```
            </TabItem>
            <TabItem value="maven" label="Maven">
                ```xml
                <dependency>
                    <groupId>io.github.danielliu1123</groupId>
                    <artifactId>grpc-starter-transcoding-webmvc</artifactId>
                </dependency>
                ```
            </TabItem>
        </Tabs>
    </TabItem>
    <TabItem value="webflux" label="WebFlux">
        <Tabs>
            <TabItem value="gradle" label="Gradle">
                ```groovy
                implementation("io.github.danielliu1123:grpc-server-boot-starter")){
                exclude(group: "io.grpc", module: "grpc-netty-shaded")
            }
                implementation("io.github.danielliu1123:grpc-starter-transcoding-webflux")
                runtimeOnly("io.grpc:grpc-netty")
                ```
            </TabItem>
            <TabItem value="maven" label="Maven">
                ```xml
                <dependency>
                    <groupId>io.github.danielliu1123</groupId>
                    <artifactId>grpc-server-boot-starter</artifactId>
                    <exclusions>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-netty-shaded</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>io.github.danielliu1123</groupId>
                    <artifactId>grpc-starter-transcoding-webflux</artifactId>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-netty</artifactId>
                    <scope>runtime</scope>
                </dependency>
                ```
            </TabItem>
        </Tabs>
    </TabItem>
</Tabs>

:::tip
Because both webflux and gRPC use netty, if you use the `grpc-netty-shaded` dependency, the final jar package will be larger (~9MB).
Therefore, exclude the `grpc-netty-shaded` dependency and use the `grpc-netty` dependency instead.
:::

## Example

<details>
    <summary>simpleservice.proto</summary>
    <pre><code>
```protobuf
syntax = "proto3";

import "google/api/annotations.proto";

package transcoding.mvc;

message SimpleRequest {
    string requestMessage = 1;
}

message SimpleResponse {
    string responseMessage = 1;
}

service SimpleService {
    rpc UnaryRpc (SimpleRequest) returns (SimpleResponse) {
        option (google.api.http) = {
            post: "/unary",
            body: "*"
        };
    }
}
```
    </code></pre>
</details>

**Access via HTTP:**

```shell
curl -X POST -d '{"requestMessage": "World"}' http://localhost:8080/transcoding.mvc.SimpleService/UnaryRpc
curl -X POST -d '{"requestMessage": "World"}' http://localhost:8080/unary
```

:::info
The default mapping path is `POST /package.Service/MethodName` when the `google.api.http` option is not specified.
:::

**Access via gRPC:**

```shell
grpcurl -plaintext -d '{"requestMessage": "World"}' localhost:9090 transcoding.mvc.SimpleService/UnaryRpc
```

## Extension Points

### HeaderConverter

`HeaderConverter` is used to
- Convert HTTP headers to gRPC metadata when transcode from HTTP to gRPC.
- Convert gRPC metadata to HTTP headers when transcode from gRPC to HTTP.

The default implementation is `DefaultHeaderConverter`.

When converting HTTP headers to gRPC metadata (request),
it removes all http canonical headers (except Authorization) and leaves only custom headers.

When converting gRPC metadata to HTTP headers (response),
it removes all http canonical headers, headers with the prefix `grpc-`, headers with the suffix `-bin` and leaves only custom headers.
