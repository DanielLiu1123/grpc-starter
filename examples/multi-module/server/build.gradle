plugins {
    id 'org.springframework.boot'
}

dependencies {
    implementation(project(":examples:multi-module:api"))
    implementation(project(":grpc-starters:grpc-server-boot-starter"))
}

apply from: "${rootDir}/gradle/protobuf.gradle"

def protocVersion = "3.25.1"
def grpcVersion = "1.58.0"

tasks.register("gen") {
    def cmd = "bash ${rootDir}/gradle/gen.sh ${layout.buildDirectory.get().asFile.absolutePath} ${protocVersion} ${grpcVersion}"
    println cmd
    def p = cmd.execute()

    p.consumeProcessOutput(System.out, System.err)
}

gen.dependsOn extractIncludeProto
compileJava.dependsOn gen

sourceSets {
    main {
        java {
            srcDirs += "${layout.buildDirectory.get().asFile.absolutePath}/generated/java"
        }
    }
}
